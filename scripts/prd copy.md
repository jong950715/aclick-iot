# 개요  
대시캠 IoT 프로젝트는 차량에 장착된 대시캠에서 버튼 한 번으로 사고·위험 구간 영상을 운전자 스마트폰으로 자동 전송해 보관 및 공유할 수 있는 오프라인-친화형 솔루션입니다. 인터넷 연결 없이도 완전히 오프라인 환경에서 동작하며, 운전자는 물리적 버튼만 누르면 중요 영상이 스마트폰으로 자동 전송됩니다. 이 솔루션은 특히 사고 현장이나 위험 구간에서 즉각적인 영상 저장 및 공유가 필요한 운전자들에게 가치를 제공합니다.

# 핵심 기능  
## 원-클릭 영상 저장
- **기능**: 물리 버튼 한 번으로 중요 순간 영상 자동 저장
- **중요성**: 운전 중 조작 최소화로 안전성 향상, 사용자 경험 단순화
- **작동 방식**: BLE/GPIO를 통한 버튼 클릭 이벤트가 IoT 장치로 전달되어 RingBuffer에서 전후 30초 영상 자동 컷

## 완전 오프라인 전송 체계
- **기능**: 셀룰러 네트워크 없이도 스마트폰으로 영상 전송
- **중요성**: 통신 인프라 의존도 감소, 어디서나 안정적 작동
- **작동 방식**: Local Only Hotspot과 Bluetooth Classic을 활용한 직접 통신

## 고화질 원본 영상 유지
- **기능**: 인코딩 없이 원본 화질 그대로 전송
- **중요성**: 증거 자료로서의 가치 보존, 세부 정보 유지
- **작동 방식**: CameraX RingBuffer와 MediaMuxer를 활용한 키프레임 경계 복사

## 보안 통신 프로토콜
- **기능**: 암호화된 SSID/PW 전달 및 자체 TLS CA 활용
- **중요성**: 무단 접근 차단, 데이터 보안 유지
- **작동 방식**: RSA-2048 암호화, TLSv1.3, 자체 Root CA를 통한 인증서 Pinning

# 사용자 경험  
## 사용자 페르소나
- **일반 운전자**: 사고 증거 확보 필요, 기술에 능숙하지 않음
- **택시/버스 운전기사**: 장시간 운행 중 특정 상황 기록 필요
- **물류/배송 기사**: 배송 과정 중 특이사항 기록 필요

## 주요 사용자 흐름
1. 차량 시동 시 IoT 대시캠과 스마트폰 앱이 자동 연결됨
2. 중요 상황 발생 시 운전자가 물리 버튼 클릭
3. 스마트폰이 Local Hotspot 활성화하고 보안 연결 수립
4. IoT 장치가 전후 30초 영상을 컷팅하여 스마트폰으로 전송
5. 영상이 스마트폰에 저장되고 사용자에게 알림

## UI/UX 고려사항
- 대시보드: Hotspot/BT/Wi-Fi/Upload 상태 모니터링
- 갤러리: 저장된 영상 클립 Grid 형태로 표시
- 알림: 새 영상 도착 시 즉시 시스템 알림 생성
- 최소한의 사용자 조작으로 핵심 기능 수행

# 기술 아키텍처  
## 시스템 구성요소
1. **스마트폰 앱 (Receiver)**
   - 플랫폼: Android 10+, Flutter 3.29.3
   - 주요 기술: Local Only Hotspot, Bluetooth Classic SPP, Jetty HTTPS 서버, Riverpod

2. **IoT 앱 (Transmitter, 초기 Mock)**
   - 플랫폼: Android (라즈베리 Pi 4 등 대체 목업)
   - 주요 기술: CameraX, Bluetooth SPP 클라이언트, WifiNetworkSpecifier, multipart HTTP POST

3. **물리 버튼**
   - 하드웨어: nRF52840 Dev Kit (향후 자체 MCU)
   - 기능: GPIO-BLE 전송(클릭) → IoT로 유선/무선 연결
## 프로젝트 구성
- 즉, 이 프로젝트는 2개의 Flutter 안드로이드 앱 (**스마트폰 앱**과 **IoT Mocking 앱**)을 포함

## 데이터 모델
- **Event**: 버튼 클릭 시 생성되는 이벤트 객체 (Protobuf 정의)
  - 상태: NEW→UPLOADING→DONE/RETRY
  - 메타데이터: 타임스탬프, 위치정보(가능시), UUID

- **Clip**: 영상 클립 파일
  - 메타데이터: 이벤트 ID, 생성 시간, 파일 크기, 해시

## API 및 통합
- **Bluetooth Classic SPP**: 초기 연결 및 페어링
- **HTTPS POST /clips**: 영상 파일 전송 (JWT 인증)
- **Event API**: 이벤트 상태 관리 및 동기화

## 인프라 요구사항
- **자체 Root CA**: TLS 보안을 위한 인증서 인프라
- **Local Storage**: 스마트폰과 IoT 모두에 로컬 저장소
- **메모리 관리**: RingBuffer를 위한 충분한 RAM (60초 영상)

# 개발 로드맵  
## MVP 요구사항
### 0. 착수·환경 세팅 (1주)
- Git mono-repo 생성 (/apps/phone, /apps/iot, /packages/core)
- CI/CD 파이프라인 구축 (GitHub Actions)
- 코드 컨벤션 및 PR 워크플로 문서화

### 1. Hotspot & Bluetooth Classic 연결 (1주)
- 스마트폰측: HotspotManager, BtClassicServer 구현
- IoT측: BtClassicClient, PageScanHandler 구현
- 시동 시 자동 연결 및 페어링 검증

### 2. 보안 채널 및 Wi-Fi 접속 자동화 (1주)
- 자체 Root CA 및 인증서 생성 스크립트
- 키 교환 서비스 및 보안 프로토콜 구현
- SSID/PW 암호화 전송 및 자동 WiFi 조인

### 3. 클립 서버 및 영상 RingBuffer 구현 (1주)
- 스마트폰측: HTTPS 서버 및 인증서 pinning
- IoT측: 영상 RingBuffer, 클립 컷팅, 업로더 구현
- 버튼 클릭 후 파일 전송 검증

### 4. 이벤트 객체 및 재시도 로직 (1주)
- 이벤트 프로토콜 정의 및 코드 생성
- 이벤트 저장소 및 상태 관리 구현
- 실패 시 재시도 및 복구 메커니즘

### 5. UI 및 최종 문서화 (1주)
- 대시보드 및 갤러리 UI 구현
- 아키텍처 및 배포 문서 작성
- 전체 시스템 통합 및 검증

## 향후 개선사항
- 실제 IoT 하드웨어로 전환 (Android → 라즈베리 Pi → 커스텀 MCU)
- 영상 분석 및 AI 위험 상황 감지 기능
- 클라우드 백업 옵션 (인터넷 연결 시)
- 다중 카메라 지원 및 360도 뷰 통합

# 논리적 의존성 체인
## 기초 구성요소 (우선 개발)
1. **통신 기반**: Bluetooth Classic 연결 및 Local Hotspot 구현
2. **보안 프로토콜**: RSA 공개키 교환 및 인증서 인프라
3. **카메라 시스템**: RingBuffer 및 클립 컷팅 메커니즘

## 실행 가능한 프론트엔드 우선 개발
1. **스마트폰 앱 기본 UI**: 상태 모니터링 및 간단한 갤러리
2. **이벤트 관리 시스템**: 사용자 알림 및 상태 표시
3. **파일 관리**: 기본적인 저장 및 조회 기능

## 단계별 기능 확장
1. **통신 → 보안 → 영상처리** 순으로 구현
2. **기본 기능 → 상태 관리 → 오류 처리 → UI 개선**
3. **MVP → 테스트 → 문서화 → 배포**

# 위험 요소 및 완화 전략  
## 기술적 도전
- **위험**: Bluetooth 연결 불안정성
  **완화**: 연결 끊김 감지 및 자동 재연결 메커니즘, 타임아웃 설정

- **위험**: 대용량 영상 전송 지연
  **완화**: 최적화된 전송 프로토콜, 프로그레스 모니터링, 분할 전송

- **위험**: 메모리 제약으로 인한 RingBuffer 오류
  **완화**: 메모리 사용량 모니터링, 적응형 버퍼 크기 조정

## MVP 구성 최적화
- **위험**: 기능 범위 확장으로 일정 지연
  **완화**: 명확한 MVP 정의, 단계별 접근 방식, 엄격한 우선순위 지정

- **위험**: 하드웨어 종속성으로 인한 개발 지연
  **완화**: 초기 단계에서 소프트웨어 목업 사용, 인터페이스 추상화

## 자원 제약
- **위험**: 성능 및 배터리 효율성
  **완화**: 에너지 효율적인 통신 패턴, 최적화된 코드

- **위험**: 저장 공간 한계
  **완화**: 지능형 저장 관리, 오래된 데이터 자동 정리

# 부록  
## 연구 결과
- Bluetooth Classic SPP vs BLE 성능 비교
- 다양한 네트워크 토폴로지 테스트 결과
- 카메라 해상도별 RingBuffer 메모리 요구사항

## 기술 명세
- **카메라 스펙**: 720p/1080p, 30fps, H.264 encoding
- **버튼 인터페이스**: nRF52840 BLE/GPIO 연결 스펙
- **파일 크기**: 30초 기준 720p=약 15MB, 1080p=약 30MB
- **보안 규격**: TLSv1.3, ECDHE-RSA-AES256-GCM-SHA384
- **품질 요구사항**: 단위 테스트 커버리지 ≥ 60%, Lint 100%
